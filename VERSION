V422

Release Date: 2025-01-30

Backend Fix: Movement Synchronization (Send targetX/targetZ)

Fixed critical bug where characters showed running animation but didn't actually move (running in place).
Server now sends targetX/targetZ in broadcastGameState so clients know where players are trying to move.

Root Cause:
- Server's broadcastGameState() only sent current position (x, z) and isMoving flag
- Server did NOT send target position (targetX, targetZ)
- Client received current position but didn't know where player was trying to move to
- Client's local targetX/targetZ remained unchanged while server position was updated
- Result: Character mesh showed at server position but tried to move to old local target
- This caused running-in-place animation

Changes:
- Added targetX and targetZ to server's broadcastGameState() payload
- Server now sends: team, x, z, targetX, targetZ, isMoving, isDead
- Client receives and applies server's targetX/targetZ to align movement goals
- Both self and opponent now use server-authoritative target positions
- This ensures client knows where server wants the player to move

Technical Details:
- Server's updatePlayerMovement() interpolates from x/z toward targetX/targetZ at PLAYER_SPEED
- Client's updatePlayerMovement() does the same interpolation for smooth visuals
- By syncing targetX/targetZ, both server and client move toward the same goal
- Position error reconciliation (threshold 25) still applies for self to handle prediction errors

Previous Fixes (V419):
- Fixed spawn position bug (team type coercion with Number())
- Fixed latency regression (removed high-frequency logs)
- Spawn positions: Team 1 at (-30, 0), Team 2 at (30, 0)

Previous Fixes (V417):

Changes:
- Added real delta time calculation in tick() function
- Changed updatePlayerMovement(dt) to use actual elapsed time instead of fixed interval
- Changed updateKnives(dt) to use actual elapsed time
- Added dt clamping (max 0.1s) to prevent huge jumps after pauses
- Added time-based network update accumulator (replaces tick counter)
- Added per-second logging: ticks/sec and broadcasts/sec for monitoring
- Movement now uses: moveDistance = PLAYER_SPEED * dt (where dt is in seconds)

Technical Details:
- PLAYER_SPEED remains 2.5 units/second
- dt is calculated as: (now - lastUpdateTime) / 1000 and clamped to max 0.1s
- Network updates accumulate time and broadcast when >= 1/20 seconds (50ms)
- Server logs actual tick rate and broadcast rate every second for monitoring

Previous Fixes (V416):

Issue 1: Render Deployment Timeout
Root Cause:
- Server was not binding to '0.0.0.0' (required for Render's external health checks)
- Missing health check endpoint for Render to probe

Changes:
- Added health check routes: GET / and GET /health
- Server now binds to '0.0.0.0' explicitly
- Added detailed startup logging showing PORT and host

Issue 2: Team Selection Blocked in 1v1 Mode
Root Cause:
- teamSelect handler blocked ALL team selection in 1v1 mode
- Should only block team SWITCHING, not initial selection

Changes:
- Fixed teamSelect handler to check if player is already in a team
- Only blocks switching after player is assigned (allows first-time selection)
- Added comprehensive debugging logs with [TEAM-SELECT-SERVER] prefix
- Added team capacity validation (1v1: 1 per team, 3v3: 3 per team)

Issue 3: Host Disconnect Not Handled
Root Cause:
- When host disconnected, room remained open with guests stuck inside
- No cleanup or notification to remaining players

Changes:
- Added host disconnect detection in disconnect handler
- When host disconnects, emit hostDisconnected event to all players
- Immediately close room and clean up game engine
- Added [DISCONNECT] logging for debugging

Previous Version (V410):
- Server-Authoritative Architecture Implementation
- 60Hz server game loop with 20Hz network updates
- Client-side prediction with server reconciliation
